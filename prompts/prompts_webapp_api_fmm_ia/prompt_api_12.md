# prompt_api_12.md

## prompt
Can you use the module "displacy" inside streamlit when the result is shown?




## output
To use the `displacy` module inside Streamlit to visualize the entity extraction results, you need to integrate the HTML rendering capabilities of Streamlit with the output generated by `displacy`. Here's how you can modify the Streamlit app to achieve this:

```python
import streamlit as st
import requests
from spacy import displacy

# Define FastAPI endpoint URL
FASTAPI_URL = "http://localhost:8000/entities"

# Streamlit UI
st.title("Entity Extraction with FastAPI and Streamlit")

# Text input form
text_input = st.text_area("Enter your text here:")

# Button to trigger entity extraction
if st.button("Extract Entities"):
    # Send text to FastAPI endpoint for entity extraction
    response = requests.post(FASTAPI_URL, json={"input": text_input})

    # Check if request is successful
    if response.status_code == 200:
        entities = response.json()["extractions"]

        # Create a list of tuples containing the entity label, start, and end indices
        entities_data = [(entity['name'], entity['first_index'], entity['last_index']) for entity in entities]

        # Visualize entities using displacy
        doc = {"text": text_input, "ents": entities_data, "title": None}
        html = displacy.render(doc, style="ent", page=True)

        # Display the HTML output in Streamlit
        st.write(html, unsafe_allow_html=True)
    else:
        st.error("Error extracting entities. Please try again.")
```

This code sends the text input to the FastAPI endpoint for entity extraction, receives the extracted entities, and then visualizes them using `displacy.render()`. The resulting HTML output is then displayed in the Streamlit app using `st.write()` with `unsafe_allow_html=True` to render the HTML content safely.

Make sure you have the `spacy` library installed, as `displacy` is a part of it. You may need to install it via pip:

```bash
pip install spacy
```

Ensure that your FastAPI server is running and accessible at `http://localhost:8000/entities`. Adjust the URL accordingly if your FastAPI server is hosted elsewhere or has a different endpoint structure.